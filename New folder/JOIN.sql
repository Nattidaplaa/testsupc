;WITH CTE AS
(
	SELECT [ITEMID], [INVENTDIMID]
	FROM [Test_INVENTITEMBARCODE]
	
)
SELECT	DISTINCT		  
				  
				  --T1.[ITEMID],  --?????????? ??????????????????????????? 
				  --T1.[INVENTDIMID],  --????????????? ??????????????????????????? 
	     --         T1.[SPC_ITEMNAME],  --??????????
	     --         T2.[PRIMARYVENDORID] + ' : ' + T3.[NAME] AS NewPriName,	  --??????????????+??????????????
				  T4.[NUM]+ ' : ' +T4.[DESCRIPTION]  AS NewNum		--???????? + ????????(???????????)

FROM  [Test_INVENTITEMBARCODE] T1 WITH(NOLOCK)
INNER JOIN [Test_INVENTTABLE] T2 WITH(NOLOCK) ON  T1.[ITEMID] = T2.[ITEMID]
AND     T1.[DATAAREAID] = 'spc'
INNER JOIN [Test_VENDTABLE] T3 WITH(NOLOCK) ON T2.[PRIMARYVENDORID] = T3.[ACCOUNTNUM]
AND     T2.[DATAAREAID] = 'spc'
INNER JOIN [Test_DIMENSIONS] T4 WITH(NOLOCK) ON T1.[SPC_ITEMBUYERGROUPID] = T4.[NUM]
AND     T3.[DATAAREAID] = 'spc'
AND     T4.[DATAAREAID] = 'spc'
INNER JOIN CTE WITH(NOLOCK) ON CTE.[ITEMID] = T2.[ITEMID] 
AND  CTE.[INVENTDIMID] = T1.[INVENTDIMID]
WHERE T4.[DESCRIPTION] LikE N'%???????%'




--;WITH CTE AS
--(
--	SELECT [ITEMID], [INVENTDIMID]
--	FROM [Test_INVENTITEMBARCODE]
	
--)
--,CTE2 AS (
--SELECT	DISTINCT		  
				  
--				  T1.[ITEMID],  --?????????? ??????????????????????????? 
--				  T1.[INVENTDIMID],  --????????????? ??????????????????????????? 
--	              T1.[SPC_ITEMNAME],  --??????????
--	              T2.[PRIMARYVENDORID] + ' : ' + T3.[NAME] AS NewPriName,	  --??????????????+??????????????
--				  T4.[NUM]+ ' : ' +T4.[DESCRIPTION]  AS NewNum		--???????? + ????????(???????????)
--				 , T4.[NUM]	as num	--???????? + ????????(???????????)

--FROM  [Test_INVENTITEMBARCODE] T1 WITH(NOLOCK)
--INNER JOIN [Test_INVENTTABLE] T2 WITH(NOLOCK) ON  T1.[ITEMID] = T2.[ITEMID]
--AND     T1.[DATAAREAID] = 'spc'
--INNER JOIN [Test_VENDTABLE] T3 WITH(NOLOCK) ON T2.[PRIMARYVENDORID] = T3.[ACCOUNTNUM]
--AND     T2.[DATAAREAID] = 'spc'
--INNER JOIN [Test_DIMENSIONS] T4 WITH(NOLOCK) ON T1.[SPC_ITEMBUYERGROUPID] = T4.[NUM]
--AND     T3.[DATAAREAID] = 'spc'
--AND     T4.[DATAAREAID] = 'spc'
--INNER JOIN CTE WITH(NOLOCK) ON CTE.[ITEMID] = T2.[ITEMID] 
--AND  CTE.[INVENTDIMID] = T1.[INVENTDIMID]
----WHERE [NUM] = ''
--)
--SELECT NewPriName 
--FROM CTE2 
--WHERE num = 'D170'
